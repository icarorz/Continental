<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Juego Continental - Mini App</title>
  <!-- Hoja de estilos de Bootstrap -->
  <link 
    rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
    integrity="sha384-ENjdO4Dr2bkBIFxQpeHehFVn1bNtdfHniPn9ABg5yLLhf/EpZXH9IhRJ9LYBF8xD" 
    crossorigin="anonymous"
  >

  <style>
    /* Puedes mantener o agregar estilos personalizados si lo deseas */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- Contenedor principal de Bootstrap -->
  <div class="container my-4">

    <h1 class="text-center mb-4">Continental - Mini Aplicación</h1>

    <!-- Sección Alta de Jugadores -->
    <div class="player-registration card p-3 mb-4">
      <h2>Alta de Jugadores</h2>
      <div class="input-group mb-3">
        <input 
          type="text" 
          id="playerNameInput" 
          class="form-control" 
          placeholder="Nombre del jugador" 
          aria-label="Nombre del jugador"
        />
        <button class="btn btn-primary" onclick="addPlayer()">Añadir Jugador</button>
      </div>

      <div class="player-list mb-3">
        <h3>Jugadores registrados:</h3>
        <ul id="playerList" class="list-group"></ul>
      </div>

      <button 
        id="startGameBtn" 
        onclick="startGame()" 
        class="btn btn-success hidden"
      >
        Iniciar Partida
      </button>
    </div>

    <!-- Sección Información de la Ronda -->
    <div class="round-info card p-3 mb-4 hidden" id="roundInfoSection">
      <h2>
        Ronda <span id="roundNumber"></span>: 
        <small class="text-muted" id="roundDescription"></small>
      </h2>
      <p class="mb-3">
        <strong>Reparte:</strong> 
        <span id="dealerName" class="badge text-bg-primary"></span>
      </p>
      
      <div>
        <h3>Introduce puntos de esta ronda</h3>
        <div id="playersInputPoints" class="row"></div>
        <button 
          class="btn btn-primary mt-3" 
          onclick="submitRoundPoints()"
        >
          Registrar Puntos y Pasar a la Siguiente Ronda
        </button>
      </div>
    </div>

    <!-- Sección Tabla de Puntuaciones -->
    <div class="score-table card p-3 mb-4 hidden" id="scoreTableSection">
      <h2>Puntuaciones Acumuladas</h2>
      <div class="table-responsive">
        <table class="table table-striped table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>Jugador</th>
              <th>Ronda 1</th>
              <th>Ronda 2</th>
              <th>Ronda 3</th>
              <th>Ronda 4</th>
              <th>Ronda 5</th>
              <th>Ronda 6</th>
              <th>Ronda 7</th>
              <th>Total Puntos</th>
            </tr>
          </thead>
          <tbody id="scoreTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Sección Ranking Final -->
    <div class="card p-3 mb-4 hidden" id="finalRankingSection">
      <h2>Ranking Final</h2>
      <ol id="finalRankingList" class="list-group list-group-numbered mb-3"></ol>
      <button 
        class="btn btn-warning" 
        onclick="restartGame()"
      >
        Iniciar una nueva partida
      </button>
    </div>

  </div><!-- Fin contenedor principal -->

  <!-- Scripts de Bootstrap (opcional, si necesitas funcionalidad JS de Bootstrap) -->
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+Ryfj9EN5rG7vo0I8quq6UBLGSeJ6" 
    crossorigin="anonymous">
  </script>

  <script>
    // --- Variables globales ---
    let players = [];
    const roundsDescription = [
      "Dos tríos",
      "Dos escaleras",
      "Dos tríos, Una escalera",
      "Dos escaleras, Un trío",
      "Tres tríos",
      "Tres escaleras",
      "Dos tríos, Dos escaleras"
    ];
    let currentRound = 0;
    let dealerIndex = 0;

    // --- Funciones de registro de jugadores ---
    function addPlayer() {
      const input = document.getElementById("playerNameInput");
      const name = input.value.trim();
      if (name !== "") {
        players.push({
          name: name,
          points: new Array(7).fill(null),
          total: 0
        });
        input.value = "";
        renderPlayerList();
      }
    }

    function renderPlayerList() {
      const playerListElement = document.getElementById("playerList");
      playerListElement.innerHTML = "";
      players.forEach((player, index) => {
        const li = document.createElement("li");
        li.textContent = `${index + 1}. ${player.name}`;
        li.classList.add("list-group-item");
        playerListElement.appendChild(li);
      });
      document.getElementById("startGameBtn").classList.toggle("hidden", players.length < 2);
    }

    // --- Iniciar el juego ---
    function startGame() {
      if (players.length < 2) {
        alert("Debes tener al menos 2 jugadores para iniciar la partida.");
        return;
      }
      document.querySelector(".player-registration").classList.add("hidden");
      document.getElementById("roundInfoSection").classList.remove("hidden");
      document.getElementById("scoreTableSection").classList.remove("hidden");

      currentRound = 0;
      dealerIndex = 0;
      initializeScoreTable();
      showRoundInfo();
    }

    // --- Mostramos la información de la ronda actual ---
    function showRoundInfo() {
      document.getElementById("roundNumber").textContent = currentRound + 1;
      document.getElementById("roundDescription").textContent = roundsDescription[currentRound];
      document.getElementById("dealerName").textContent = players[dealerIndex].name;

      const container = document.getElementById("playersInputPoints");
      container.innerHTML = "";
      players.forEach((player, index) => {
        const div = document.createElement("div");
        div.classList.add("col-12", "col-sm-6", "col-md-4", "mb-3");

        const label = document.createElement("label");
        label.classList.add("form-label", "me-2");
        label.textContent = `Puntos de ${player.name}:`;

        const input = document.createElement("input");
        input.type = "number";
        input.id = `pointsInput-${index}`;
        input.classList.add("form-control", "mt-1");

        div.appendChild(label);
        div.appendChild(input);
        container.appendChild(div);
      });
    }

    // --- Registrar los puntos y pasar a la siguiente ronda ---
    function submitRoundPoints() {
      players.forEach((player, index) => {
        const input = document.getElementById(`pointsInput-${index}`);
        const roundPoints = parseInt(input.value) || 0;
        player.points[currentRound] = roundPoints;
      });
      updateScoreTable();
      dealerIndex = (dealerIndex + 1) % players.length;

      if (currentRound === 6) {
        showFinalRanking();
      } else {
        currentRound++;
        showRoundInfo();
      }
    }

    // --- Inicializar la tabla de puntuaciones ---
    function initializeScoreTable() {
      const tbody = document.getElementById("scoreTableBody");
      tbody.innerHTML = "";
      players.forEach((player) => {
        const row = document.createElement("tr");

        // Nombre
        const nameCell = document.createElement("td");
        nameCell.textContent = player.name;
        row.appendChild(nameCell);

        // Rondas 1-7
        for (let i = 0; i < 7; i++) {
          const roundCell = document.createElement("td");
          roundCell.id = `score-${player.name}-r${i + 1}`;
          roundCell.textContent = "-";
          row.appendChild(roundCell);
        }

        // Total
        const totalCell = document.createElement("td");
        totalCell.id = `total-${player.name}`;
        totalCell.textContent = "0";
        row.appendChild(totalCell);

        tbody.appendChild(row);
      });
    }

    // --- Actualizar tabla de puntuaciones ---
    function updateScoreTable() {
      players.forEach((player) => {
        for (let i = 0; i < 7; i++) {
          const roundCell = document.getElementById(`score-${player.name}-r${i + 1}`);
          if (player.points[i] !== null) {
            roundCell.textContent = player.points[i];
          } else {
            roundCell.textContent = "-";
          }
        }
        const sum = player.points.reduce((acc, val) => acc + (val || 0), 0);
        player.total = sum;
        document.getElementById(`total-${player.name}`).textContent = sum;
      });
    }

    // --- Mostrar Ranking Final ---
    function showFinalRanking() {
      document.getElementById("roundInfoSection").classList.add("hidden");

      const finalRankingSection = document.getElementById("finalRankingSection");
      finalRankingSection.classList.remove("hidden");

      const sortedPlayers = [...players].sort((a, b) => a.total - b.total);
      const rankingList = document.getElementById("finalRankingList");
      rankingList.innerHTML = "";
      sortedPlayers.forEach((player) => {
        const li = document.createElement("li");
        li.textContent = `${player.name} - ${player.total} puntos`;
        li.classList.add("list-group-item");
        rankingList.appendChild(li);
      });
    }

    // --- Reiniciar la partida ---
    function restartGame() {
      players.forEach((player) => {
        player.points = new Array(7).fill(null);
        player.total = 0;
      });
      currentRound = 0;
      dealerIndex = 0;

      document.getElementById("roundInfoSection").classList.remove("hidden");
      document.getElementById("finalRankingSection").classList.add("hidden");

      initializeScoreTable();
      showRoundInfo();
    }
  </script>
</body>
</html>

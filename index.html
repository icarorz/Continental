<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Continental - Mini App con Resaltado</title>
  <!-- Hoja de estilos de Bootstrap (CDN) -->
  <link 
    rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
    integrity="sha384-ENjdO4Dr2bkBIFxQpeHehFVn1bNtdfHniPn9ABg5yLLhf/EpZXH9IhRJ9LYBF8xD" 
    crossorigin="anonymous"
  >
  <style>
    /* Fondo de la página con degradado suave */
    body {
      background: linear-gradient(to right, #f6f0c4, #dae2f8);
      min-height: 100vh;
    }

    /* Para ocultar secciones cuando no se necesitan */
    .hidden {
      display: none !important;
    }

    /* Cards semi-transparentes */
    .custom-card {
      background-color: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(2px);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    /* Resaltar fila con menos puntos (líder) en gris claro */
    .bg-leading {
      background-color: #e0e0e0 !important; /* Gris claro */
    }

    /* Resaltar fila con más puntos (último lugar) en naranja claro */
    .bg-loser {
      background-color: #ffe9cc !important; /* Naranja clarito */
    }

    .custom-card-header {
      background-color: rgba(255, 255, 255, 0.5);
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="container py-4">

    <h1 class="text-center mb-4">Continental - Mini Aplicación</h1>

    <!-- Sección Alta de Jugadores -->
    <div class="player-registration custom-card p-3 mb-4">
      <h2 class="mb-3">Alta de Jugadores</h2>
      <div class="input-group mb-3">
        <input 
          type="text" 
          id="playerNameInput" 
          class="form-control" 
          placeholder="Nombre del jugador" 
          aria-label="Nombre del jugador"
        />
        <button class="btn btn-primary" onclick="addPlayer()">Añadir Jugador</button>
      </div>

      <div class="player-list mb-3">
        <h4>Jugadores registrados:</h4>
        <ul id="playerList" class="list-group"></ul>
      </div>

      <button 
        id="startGameBtn" 
        onclick="startGame()" 
        class="btn btn-success hidden"
      >
        Iniciar Partida
      </button>
    </div>

    <!-- Sección Información de la Ronda -->
    <div class="round-info custom-card p-3 mb-4 hidden" id="roundInfoSection">
      <div class="custom-card-header p-2 mb-3 rounded">
        <h2 class="m-0">
          Ronda <span id="roundNumber"></span>: 
          <small class="text-muted" id="roundDescription"></small>
        </h2>
      </div>
      
      <p class="mb-3">
        <strong>Reparte:</strong> 
        <span id="dealerName" class="badge bg-primary"></span>
      </p>
      
      <div>
        <h3>Introduce puntos de esta ronda</h3>
        <div id="playersInputPoints" class="row"></div>
        <button 
          class="btn btn-primary mt-3" 
          onclick="submitRoundPoints()"
        >
          Registrar Puntos y Pasar a la Siguiente Ronda
        </button>
      </div>
    </div>

    <!-- Sección Tabla de Puntuaciones -->
    <div class="score-table custom-card p-3 mb-4 hidden" id="scoreTableSection">
      <h2 class="mb-3">Puntuaciones Acumuladas</h2>
      <div class="table-responsive">
        <!-- 
          .table-dark en el thead para el fondo oscuro,
          .table-striped y .table-bordered para el estilo
        -->
        <table class="table table-striped table-bordered text-center align-middle">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>Jugador</th>
              <th>Ronda 1</th>
              <th>Ronda 2</th>
              <th>Ronda 3</th>
              <th>Ronda 4</th>
              <th>Ronda 5</th>
              <th>Ronda 6</th>
              <th>Ronda 7</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="scoreTableBody" class="table-group-divider"></tbody>
        </table>
      </div>
    </div>

    <!-- Sección Ranking Final -->
    <div class="custom-card p-3 mb-4 hidden" id="finalRankingSection">
      <h2>Ranking Final</h2>
      <ol id="finalRankingList" class="list-group list-group-numbered mb-3"></ol>
      <button 
        class="btn btn-warning" 
        onclick="restartGame()"
      >
        Iniciar una nueva partida
      </button>
    </div>

  </div><!-- Fin .container -->

  <!-- Scripts de Bootstrap (CDN) -->
  <script 
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+Ryfj9EN5rG7vo0I8quq6UBLGSeJ6" 
    crossorigin="anonymous">
  </script>

  <!-- Lógica de la aplicación -->
  <script>
    // --- Variables globales ---
    let players = [];
    const roundsDescription = [
      "Dos tríos",
      "Dos escaleras",
      "Dos tríos, Una escalera",
      "Dos escaleras, Un trío",
      "Tres tríos",
      "Tres escaleras",
      "Dos tríos, Dos escaleras"
    ];
    let currentRound = 0;
    let dealerIndex = 0;

    // --- Agregar nuevo jugador ---
    function addPlayer() {
      const input = document.getElementById("playerNameInput");
      const name = input.value.trim();
      if (name !== "") {
        players.push({
          name: name,
          points: new Array(7).fill(null),
          total: 0
        });
        input.value = "";
        renderPlayerList();
      }
    }

    function renderPlayerList() {
      const playerListElement = document.getElementById("playerList");
      playerListElement.innerHTML = "";
      players.forEach((player, index) => {
        const li = document.createElement("li");
        li.textContent = `${index + 1}. ${player.name}`;
        li.classList.add("list-group-item");
        playerListElement.appendChild(li);
      });
      // Mostrar el botón de inicio si hay al menos 2 jugadores
      document.getElementById("startGameBtn").classList.toggle("hidden", players.length < 2);
    }

    // --- Iniciar el juego ---
    function startGame() {
      if (players.length < 2) {
        alert("Debes tener al menos 2 jugadores para iniciar la partida.");
        return;
      }
      // Ocultamos la sección de registro
      document.querySelector(".player-registration").classList.add("hidden");
      // Mostramos la info de la ronda y la tabla de puntuaciones
      document.getElementById("roundInfoSection").classList.remove("hidden");
      document.getElementById("scoreTableSection").classList.remove("hidden");

      currentRound = 0;
      dealerIndex = 0;
      initializeScoreTable();
      showRoundInfo();
    }

    // --- Mostrar información de la ronda actual ---
    function showRoundInfo() {
      document.getElementById("roundNumber").textContent = currentRound + 1;
      document.getElementById("roundDescription").textContent = roundsDescription[currentRound];
      document.getElementById("dealerName").textContent = players[dealerIndex].name;

      const container = document.getElementById("playersInputPoints");
      container.innerHTML = "";
      players.forEach((player, index) => {
        const div = document.createElement("div");
        div.classList.add("col-12", "col-md-6", "col-lg-4", "mb-3");

        const label = document.createElement("label");
        label.classList.add("form-label", "fw-semibold");
        label.textContent = `Puntos de ${player.name}:`;

        const input = document.createElement("input");
        input.type = "number";
        input.id = `pointsInput-${index}`;
        input.classList.add("form-control", "mt-1");

        div.appendChild(label);
        div.appendChild(input);
        container.appendChild(div);
      });
    }

    // --- Registrar puntos y pasar a la siguiente ronda ---
    function submitRoundPoints() {
      players.forEach((player, index) => {
        const input = document.getElementById(`pointsInput-${index}`);
        const roundPoints = parseInt(input.value) || 0;
        player.points[currentRound] = roundPoints;
      });

      updateScoreTable();

      // Cambio de repartidor secuencial
      dealerIndex = (dealerIndex + 1) % players.length;

      if (currentRound === 6) {
        // Si era la última ronda, mostrar ranking final
        showFinalRanking();
      } else {
        // Caso contrario, siguiente ronda
        currentRound++;
        showRoundInfo();
      }
    }

    // --- Inicializar tabla de puntuaciones ---
    function initializeScoreTable() {
      const tbody = document.getElementById("scoreTableBody");
      tbody.innerHTML = "";
      players.forEach((player, index) => {
        // Para identificar la fila de cada jugador
        const row = document.createElement("tr");
        // Le damos un id para luego poder manipularlo (resaltar si es min o max)
        row.id = `row-${index}`;

        // Columna con #
        const indexCell = document.createElement("td");
        indexCell.textContent = index + 1;
        row.appendChild(indexCell);

        // Columna con nombre
        const nameCell = document.createElement("td");
        nameCell.textContent = player.name;
        row.appendChild(nameCell);

        // Columnas para las 7 rondas
        for (let i = 0; i < 7; i++) {
          const roundCell = document.createElement("td");
          roundCell.id = `score-${index}-r${i + 1}`;
          roundCell.textContent = "-";
          row.appendChild(roundCell);
        }

        // Columna con total
        const totalCell = document.createElement("td");
        totalCell.id = `total-${index}`;
        totalCell.textContent = "0";
        row.appendChild(totalCell);

        tbody.appendChild(row);
      });
    }

    // --- Actualizar tabla de puntuaciones y resaltar filas ---
    function updateScoreTable() {
      // Primero, actualizamos la tabla con los nuevos puntos
      players.forEach((player, index) => {
        // Calcula el total
        let sum = 0;
        for (let i = 0; i < 7; i++) {
          const roundPoints = player.points[i] ?? 0;
          sum += roundPoints;

          // Actualiza celda de la ronda
          const roundCell = document.getElementById(`score-${index}-r${i + 1}`);
          roundCell.textContent = roundPoints !== null ? roundPoints : "-";
        }
        player.total = sum;
        // Actualiza celda total
        const totalCell = document.getElementById(`total-${index}`);
        totalCell.textContent = sum;
      });

      // Ahora destacamos el que tiene menos puntos y el que tiene más puntos
      let minPoints = Infinity;
      let maxPoints = -Infinity;

      // Hallar min y max
      players.forEach((p) => {
        if (p.total < minPoints) minPoints = p.total;
        if (p.total > maxPoints) maxPoints = p.total;
      });

      // Aplicar clases a las filas
      players.forEach((player, index) => {
        const row = document.getElementById(`row-${index}`);
        // Quitamos las clases previas por si las tenía
        row.classList.remove("bg-leading", "bg-loser");

        // Si coincide con el mínimo, lo marcamos de gris
        if (player.total === minPoints) {
          row.classList.add("bg-leading");
        }
        // Si coincide con el máximo, lo marcamos de naranja claro
        if (player.total === maxPoints) {
          row.classList.add("bg-loser");
        }
      });
    }

    // --- Mostrar Ranking Final ---
    function showFinalRanking() {
      // Ocultamos la sección de ronda
      document.getElementById("roundInfoSection").classList.add("hidden");

      // Mostramos sección final
      const finalRankingSection = document.getElementById("finalRankingSection");
      finalRankingSection.classList.remove("hidden");

      // Ordenamos jugadores por total ascendente
      const sortedPlayers = [...players].sort((a, b) => a.total - b.total);

      const rankingList = document.getElementById("finalRankingList");
      rankingList.innerHTML = "";
      sortedPlayers.forEach((player) => {
        const li = document.createElement("li");
        li.textContent = `${player.name} - ${player.total} puntos`;
        li.classList.add("list-group-item");
        rankingList.appendChild(li);
      });
    }

    // --- Reiniciar la partida ---
    function restartGame() {
      // Reseteamos la info
      players.forEach((player) => {
        player.points = new Array(7).fill(null);
        player.total = 0;
      });
      currentRound = 0;
      dealerIndex = 0;

      // Volvemos a mostrar la sección de rondas y ocultar el ranking
      document.getElementById("roundInfoSection").classList.remove("hidden");
      document.getElementById("finalRankingSection").classList.add("hidden");

      initializeScoreTable();
      showRoundInfo();
    }
  </script>
</body>
</html>
